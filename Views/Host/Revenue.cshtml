@using WebHSPromotionType = WebHS.Models.PromotionType
@model WebHS.ViewModels.HostRevenueViewModel

@{
    ViewData["Title"] = "Báo Cáo Doanh Thu";
    Layout = "~/Views/Shared/_Layout_New.cshtml";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Báo Cáo Doanh Thu</h3>
                    <div class="card-tools">
                        <a href="@Url.Action("Dashboard")" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Quay lại Dashboard
                        </a>
                    </div>
                </div>

                <div class="card-body">
                    <!-- Revenue Summary Cards -->
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div class="card bg-success text-white">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <div class="h4 mb-0">@Model.TotalRevenue.ToString("N0") VNĐ</div>
                                            <div class="text-white-75">Tổng doanh thu</div>
                                        </div>
                                        <div class="fa-3x opacity-25">
                                            <i class="fas fa-money-bill-wave"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="card bg-info text-white">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <div class="h4 mb-0">@Model.ThisMonthRevenue.ToString("N0") VNĐ</div>
                                            <div class="text-white-75">Doanh thu tháng này</div>
                                        </div>
                                        <div class="fa-3x opacity-25">
                                            <i class="fas fa-calendar-alt"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="card bg-warning text-white">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <div class="h4 mb-0">@Model.LastMonthRevenue.ToString("N0") VNĐ</div>
                                            <div class="text-white-75">Doanh thu tháng trước</div>
                                        </div>
                                        <div class="fa-3x opacity-25">
                                            <i class="fas fa-chart-line"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Revenue by Homestay -->
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h4 class="card-title">Doanh thu theo Homestay</h4>
                                </div>
                                <div class="card-body">
                                    @if(Model.RevenueByHomestay?.Any() == true)
                                    {
                                        <div class="table-responsive">
                                            <table class="table table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>Tên Homestay</th>
                                                        <th class="text-right">Doanh thu</th>
                                                        <th class="text-right">% Tổng doanh thu</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @foreach(var item in Model.RevenueByHomestay.OrderByDescending(x => x.Value))
                                                    {
                                                        var percentage = Model.TotalRevenue > 0 ? (item.Value / Model.TotalRevenue * 100) : 0;
                                                        <tr>
                                                            <td>@item.Key</td>
                                                            <td class="text-right">@item.Value.ToString("N0") VNĐ</td>
                                                            <td class="text-right">@percentage.ToString("F1")%</td>
                                                        </tr>
                                                    }
                                                </tbody>
                                            </table>
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="text-center py-5">
                                            <i class="fas fa-chart-bar fa-3x text-muted mb-3"></i>
                                            <h4>Chưa có doanh thu</h4>
                                            <p class="text-muted">Bạn chưa có doanh thu từ các homestay của mình.</p>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Revenue Growth -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h4 class="card-title">Tăng trưởng doanh thu</h4>
                                </div>
                                <div class="card-body">
                                    @{
                                        var growthRate = Model.LastMonthRevenue > 0 
                                            ? ((Model.ThisMonthRevenue - Model.LastMonthRevenue) / Model.LastMonthRevenue * 100)
                                            : (Model.ThisMonthRevenue > 0 ? 100 : 0);
                                        var isPositiveGrowth = growthRate >= 0;
                                    }
                                    
                                    <div class="d-flex align-items-center">
                                        <div class="me-3">
                                            @if(isPositiveGrowth)
                                            {
                                                <i class="fas fa-arrow-up text-success fa-2x"></i>
                                            }
                                            else
                                            {
                                                <i class="fas fa-arrow-down text-danger fa-2x"></i>
                                            }
                                        </div>
                                        <div>
                                            <h3 class="@(isPositiveGrowth ? "text-success" : "text-danger") mb-0">
                                                @(isPositiveGrowth ? "+" : "")@growthRate.ToString("F1")%
                                            </h3>
                                            <p class="text-muted mb-0">So với tháng trước</p>
                                        </div>
                                    </div>
                                    
                                    <hr>
                                    
                                    <div class="row text-center">
                                        <div class="col-6">
                                            <div class="border-end">
                                                <h5>@Model.ThisMonthRevenue.ToString("N0") VNĐ</h5>
                                                <small class="text-muted">Tháng này</small>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <h5>@Model.LastMonthRevenue.ToString("N0") VNĐ</h5>
                                            <small class="text-muted">Tháng trước</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
